<!DOCTYPE html>
<html>
<head charset="UTF-8">
    <title>Group Assignment 2</title>
    <style type="text/css">
        textarea {
            border: thin solid black;
            position: relative;
            left: 5px;
            width: 75%;
            font: 10pt Consolas;
            overflow-x: auto;
            background-color: lightgray;
            color: brown;
        }

        p {
            text-align: justify;
            text-indent: 25px;
            width: 90%;
        }

        li {
            text-align: justify;
            width: 90%;
        }
    </style>
    <script src="../lib/webgl-utils.js"></script>
    <script src="../lib/webgl-debug.js"></script>
    <script src="../lib/cuon-utils.js"></script>
    <script src="../lib/cuon-matrix.js"></script>
    <script src="renderable.js"></script>
    <script src="camera.js"></script>
    <script type="text/javascript">
        var webgl;

        function addMessage(message) {
            console.log(message);
        }

        //This function gets called when reading a JSON file. It stores the current xml information.
        function parseJSON(jsonFile) {
            var xhttp = new XMLHttpRequest();
            xhttp.open("GET", jsonFile, false);
            xhttp.overrideMimeType("application/json");
            xhttp.send(null);
            var Doc = xhttp.responseText;
            return JSON.parse(Doc);
        }
        var gl;
        var model, camera, projMatrix;
        var fov = 26; //intial values, will change while program runs
        var near = 0.1;
        var far = 3.0;

        function loadModel(modelfilename) {
            modelfilename = "../model/" + modelfilename + "/models/model.json";
            model = new RenderableModel(gl, parseJSON(modelfilename));
            camera = new Camera(gl, model.getBounds(), [0, 1, 0]);
            projMatrix = camera.getProjMatrix(fov, near, far);
        }
        function WebGL() {
            // ... global variables ...
            var canvas = null;
            var messageField = null;

            canvas = document.getElementById("myCanvas");
            addMessage(((canvas) ? "Canvas acquired" : "Error: Can not acquire canvas"));
            gl = getWebGLContext(canvas, false);
            addMessage(((gl) ? "Rendering context for WebGL acquired" : "Error: Failed to get the rendering context for WebGL"));

            var angle = 0;
            var modelList = document.getElementById("modelList");
            loadModel(modelList.options[modelList.selectedIndex].value);

            function draw() {
                gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
                var viewMatrix = camera.getRotatedViewMatrix(angle);
                model.draw(projMatrix, viewMatrix);
                angle++;
                if (angle > 360) angle -= 360;
                window.requestAnimationFrame(draw);
            }

            gl.clearColor(0, 0, 0, 1);
            gl.enable(gl.DEPTH_TEST);

            draw();

            this.changeFOV = function (val) {
                fov = val;
                projMatrix = camera.getProjMatrix(val, near, far);
            };
            this.changeNear = function (val) {
                near = val;
                projMatrix = camera.getProjMatrix(fov, val, far);
            };
            this.changeFar = function (val) {
                far = val;
                projMatrix = camera.getProjMatrix(fov, near, val);
            };

            return 1;
        }

        function main() {
            webgl = new WebGL();
        }
    </script>
</head>
<body onload="main()">
<br>
<div style="float:left;">
<canvas id="myCanvas" width="1300px" height="700px" style="border:1px solid #FF0000;">
    Use a browser that supports Web GL.
</canvas>
</div>
<div style="float:left">
<input type="range" name="fov" min="1" max="60" step="0.5" value="32" onchange="webgl.changeFOV(value)">-FOV<br/>
<input type="range" name="near" min="0.1" max="1.8" step="0.02" value="0.1"
       onchange="webgl.changeNear(value)">-Near Plane<br/>
<input type="range" name="far" min="1.0" max="3.5" step="0.02" value="3.0" onchange="webgl.changeFar(value)">-Far
Plane<br/>
<select id="modelList" onchange="loadModel(this.value);">
    <option value='House'>House</option>
    <option value='DijonPalais'>DijonPalais</option>
    <option value='House_of_parliament'>House_of_parliament</option>
    <option value='Shrine'>Shrine</option>
</select><br/>
</div>
</body>
</html>